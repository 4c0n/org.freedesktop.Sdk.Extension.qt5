id: org.freedesktop.Sdk.Extension.qt5
branch: '21.08'
runtime: org.freedesktop.Sdk
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.llvm13
build-extension: true
build-options:
  prefix: /usr/lib/sdk/qt5
  append-path: /usr/lib/sdk/qt5/bin:/usr/lib/sdk/llvm13/bin
  append-pkg-config-path: /usr/lib/sdk/qt5/lib/pkgconfig
  append-ld-library-path: /usr/lib/sdk/qt5/lib
  prepend-ld-library-path: /usr/lib/sdk/llvm13/lib
  cflags: -g0
  cxxflags: -g0
separate-locales: false
appstream-compose: false
modules:
  - name: qt-base
    buildsystem: autotools
    config-opts:
      - -confirm-license
      - -opensource
      - -shared
      - -platform
      - linux-g++
      - -optimized-qmake
      - -release
      - -nomake
      - tests
      - -system-harfbuzz
      - -system-sqlite
      - -accessibility
      - -dbus-linked
      - -fontconfig
      - -glib
      - -icu
      - -openssl-linked
      - -no-rpath
      - -no-directfb
      - -no-kms
      - -system-proxies
      - -gtk
      - -no-use-gold-linker
    sources:
      - type: git
        url: git://code.qt.io/qt/qtbase.git
        tag: v5.15.3-lts-lgpl
        x-checker-data:
          type: anitya
          project-id: 7927
          tag-template: v$version
          stable-only: true
          versions:
            <: 6.0.0
        commit: c8989ca20fa5798f7853f07df6e150cc407c64a4
      - type: patch
        path: build-fixes-for-gcc11.patch
  - name: qt-declarative
    buildsystem: qmake
    sources:
      - type: git
        url: git://code.qt.io/qt/qtdeclarative.git
        tag: v5.15.3-lts-lgpl
        x-checker-data:
          type: anitya
          project-id: 7927
          tag-template: v$version
          stable-only: true
          versions:
            <: 6.0.0
        commit: 4bb06cfba94bcc9ddf30d968a227d00479d475b7
      - type: patch
        path: build-fixes-for-gcc11-qtdeclarative-001.patch
  - name: qt-tools
    buildsystem: qmake
    sources:
      - type: git
        url: git://code.qt.io/qt/qttools.git
        tag: v5.15.3-lts-lgpl
        x-checker-data:
          type: anitya
          project-id: 7927
          tag-template: v$version
          stable-only: true
          versions:
            <: 6.0.0
        commit: 36831ae742619e13db32ee6048d851bddee28a74
  - name: qt-base-docs
    buildsystem: simple
    build-commands:
      - ./configure --prefix=/usr/lib/sdk/qt5 -confirm-license -opensource
      - make docs
      - make install_docs
      - cp -rn examples/aggregate /usr/lib/sdk/qt5/doc/qtbase/
      - cp -rn examples/corelib /usr/lib/sdk/qt5/doc/qtcore/
      - cp -rn examples/dbus /usr/lib/sdk/qt5/doc/qtdbus/
      - cp -rn examples/embedded /usr/lib/sdk/qt5/doc/qtbase/
      - cp -rn examples/gui /usr/lib/sdk/qt5/doc/qtgui/
      - cp -rn examples/network /usr/lib/sdk/qt5/doc/qtnetwork/
      - cp -rn examples/opengl /usr/lib/sdk/qt5/doc/qtopengl/
      - cp -rn examples/qmake /usr/lib/sdk/qt5/doc/qtbase/
      - cp -rn examples/qpa /usr/lib/sdk/qt5/doc/qtbase/
      - cp -rn examples/qtconcurrent /usr/lib/sdk/qt5/doc/qtconcurrent/
      - cp -rn examples/qtestlib /usr/lib/sdk/qt5/doc/qttestlib/
      - cp -rn examples/sql /usr/lib/sdk/qt5/doc/qtsql/
      - cp -rn examples/vulkan /usr/lib/sdk/qt5/doc/qtgui/
      - cp -rn examples/widgets /usr/lib/sdk/qt5/doc/qtwidgets/
      - cp -rn examples/xml /usr/lib/sdk/qt5/doc/qtxml/
    sources:
      - type: git
        url: git://code.qt.io/qt/qtbase.git
        tag: v5.15.3-lts-lgpl
        x-checker-data:
          type: anitya
          project-id: 7927
          tag-template: v$version
          stable-only: true
          versions:
            <: 6.0.0
        commit: c8989ca20fa5798f7853f07df6e150cc407c64a4
      - type: patch
        path: build-fixes-for-gcc11.patch
  - name: metainfo
    buildsystem: simple
    build-commands:
      - mkdir -p ${FLATPAK_DEST}/share/metainfo
      - cp org.freedesktop.Sdk.Extension.qt5.metainfo.xml ${FLATPAK_DEST}/share/metainfo
      - appstream-compose --basename=org.freedesktop.Sdk.Extension.qt5 --prefix=${FLATPAK_DEST} --origin=flatpak org.freedesktop.Sdk.Extension.qt5
    sources:
      - type: file
        path: org.freedesktop.Sdk.Extension.qt5.metainfo.xml
